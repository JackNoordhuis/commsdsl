<?xml version="1.0" encoding="UTF-8"?>
<schema name="test48" endian="big">
    <description>
        Testing complex length fields
    </description>
    <fields>
        <enum name="MsgId" type="uint8" semanticType="messageId" >
            <validValue name="M1" val="1" />
            <validValue name="M2" val="2" />
            <validValue name="M3" val="3" />
            <validValue name="M4" val="4" />
            <validValue name="M5" val="5" />
        </enum>

        <bundle name="Length" semanticType="length">
            <int name="Short" type="uint8">
                <special name="HasLong" val="0xff" />
            </int>
            <optional name="Long" defaultMode="missing" cond="$Short = 0xff">
                <int name="ActLong" type="uint16" />
            </optional>
        </bundle>

        <int name="VariantType" type="uint8" failOnInvalid="true"  displayReadOnly="true" />

        <variant name="Variant1">
            <bundle name="P0">
                <int name="Type" reuse="VariantType" defaultValidValue="0"/>
                <ref field="Length" />
                <int name="Val" type="uint8" />
            </bundle>
            <bundle name="P1">
                <int name="Type" reuse="VariantType" defaultValidValue="1"/>
                <ref field="Length" />
                <int name="Val" type="uint16" />
            </bundle>
            <bundle name="P2">
                <int name="Type" reuse="VariantType" defaultValidValue="2"/>
                <ref field="Length" />
                <string name="Val"/>
            </bundle>
        </variant>
    </fields>
    
    <message name="Msg1" id="MsgId.M1">
        <list name="F1" element="Variant1" />
    </message>

    <message name="Msg2" id="MsgId.M2">
        <string name="F1" lengthPrefix="Length" />
    </message>    

    <message name="Msg3" id="MsgId.M3">
        <data name="F1" lengthPrefix="Length" defaultValue="0102030405"/>
    </message>   

    <message name="Msg4" id="MsgId.M4">
        <list name="F1" lengthPrefix="Length">
            <int name="Elem" type="uint16" />
        </list>
    </message>     

    <message name="Msg5" id="MsgId.M5">
        <list name="F1" lengthPrefix="Length" elemLengthPrefix="Length">
            <string name="Elem" />
        </list>
    </message>        

    <frame name="Frame">
        <sync name="Sync">
            <int name="Prefix" type="uint16" defaultValue="0xabcd" />
        </sync>
        <size name="Size" >
            <int name="Length" type="uint16" />
        </size>
        <id name="Id" field="MsgId" />
        <payload name="Data" />
    </frame>     
</schema>
